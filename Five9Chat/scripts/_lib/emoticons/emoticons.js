var DEFINITION = {	
		"angel":{title:"Angel",codes:["(angel)"], src:"../Common/images/emoticons/angel.png"},
		"angry":{title:"Angry",codes:[":@",":-@",":=@","x(","x-(","x=(","X(","X-(","X=("], src:"../Common/images/emoticons/angry.png"},
		"bandit":{title:"Bandit",codes:["(bandit)"], src:"../Common/images/emoticons/bandit.png"},
		"bear":{title:"Bear",codes:["(bear)","(hug)"], src:"../Common/images/emoticons/bear.png"},
		"beer":{title:"Beer",codes:["(beer)"], src:"../Common/images/emoticons/beer.png"},
		"big-smile":{title:"Big Smile",codes:[":D",":=D",":-D",":d",":=d",":-d"], src:"../Common/images/emoticons/bigsmile.png"},
		"blush":{title:"Blush",codes:["(blush)",":$",":-$",":=$",':">'], src:"../Common/images/emoticons/blush.png"},
		"bow":{title:"Bow",codes:["(bow)"], src:"../Common/images/emoticons/bow.png"},
		"broken-heart":{title:"Broken heart",codes:["(u)","(U)"], src:"../Common/images/emoticons/brokenheart.png"},
		"bug":{title:"Bug",codes:["(bug)"], src:"../Common/images/emoticons/bug.png"},
		"cake":{title:"Cake",codes:["(^)","(cake)"], src:"../Common/images/emoticons/cake.png"},
		"call":{title:"Call",codes:["(call)"], src:"../Common/images/emoticons/call.png"},
		"cash":{title:"Cash",codes:["(cash)","(mo)","($)"], src:"../Common/images/emoticons/cash.png"},
		"clapping-hands":{title:"Clapping Hands",codes:["(clap)"], src:"../Common/images/emoticons/clapping.png"},
		"coffee":{title:"Coffee",codes:["(coffee)"], src:"../Common/images/emoticons/coffee.png"},
		"cool":{title:"Cool",codes:["8)","8=)","8-)","B)","B=)","B-)","(cool)"], src:"../Common/images/emoticons/cool.png"},
		"covered-laugh":{title:"Covered Laugh",codes:["(giggle)","(chuckle)"], src:"../Common/images/emoticons/giggle.png"},
		"crying":{title:"Crying",codes:[";(",";-(",";=("], src:"../Common/images/emoticons/crying.png"},
		"dance":{title:"Dance",codes:["(dance)","\\o/","\\:D/","\\:d/"], src:"../Common/images/emoticons/dance.png"},
		"devil":{title:"Devil",codes:["(devil)"], src:"../Common/images/emoticons/devil.png"},
		"doh!":{title:"Doh!",codes:["(doh)"], src:"../Common/images/emoticons/doh.png"},
		"drink":{title:"Drink",codes:["(d)","(D)"], src:"../Common/images/emoticons/drink.png"},
		"drunk":{title:"Drunk",codes:["(drunk)"], src:"../Common/images/emoticons/drunk.png"},
		"dull":{title:"Dull",codes:["|(","|-(","|=("], src:"../Common/images/emoticons/dull.png"},
		"emo":{title:"Emo",codes:["(emo)"], src:"../Common/images/emoticons/emo.png"},
		"envy":{title:"Envy",codes:["(envy)"], src:"../Common/images/emoticons/envy.png"},
		"evil-grin":{title:"Evil grin",codes:["]:)",">:)","(grin)"], src:"../Common/images/emoticons/evilgrin.png"},
		"face-palm":{title:"Face Palm",codes:["((facepalm))"], src:"../Common/images/emoticons/facepalm.png"},
		"fingers-crossed":{title:"Fingers Crossed",codes:["((fingerscrossed))"], src:"../Common/images/emoticons/fingerscrossed.png"},
		"finger":{title:"Finger",codes:["(finger)"], src:"../Common/images/emoticons/middlefinger.png"},
		"flower":{title:"Flower",codes:["(f)","(F)"], src:"../Common/images/emoticons/flower.png"},
		"fubar":{title:"Fubar",codes:["(fubar)"], src:"../Common/images/emoticons/fubar.png"},
		"handshake":{title:"Shaking Hands",codes:["(handshake)"], src:"../Common/images/emoticons/handshake.png"},
		"happy":{title:"Happy",codes:["(happy)"], src:"../Common/images/emoticons/happy.png"},
		"headbang":{title:"Headbang",codes:["(headbang)","(banghead)"], src:"../Common/images/emoticons/headbang.png"},
		"heart":{title:"Heart",codes:["(h)","<3","(H)","(l)","(L)"], src:"../Common/images/emoticons/heart.png"},
		"heidy":{title:"Heidy",codes:["(heidy)"], src:"../Common/images/emoticons/heidy.png"},
		"hi":{title:"Hi",codes:["(hi)"], src:"../Common/images/emoticons/hi.png"},
		"high-five":{title:"High Five",codes:["(highfive)"], src:"../Common/images/emoticons/highfive.png"},
		"in-love":{title:"In love",codes:["(inlove)"], src:"../Common/images/emoticons/inlove.png"},
		"it-wasnt-me":{title:"It wasn't me",codes:["(wasntme)"], src:"../Common/images/emoticons/itwasntme.png"},
		"kiss":{title:"Kiss",codes:[":*",":=*",":-*"], src:"../Common/images/emoticons/kiss.png"},
		"lalala":{title:"Lalala",codes:["(lalala)"], src:"../Common/images/emoticons/lalala.png"},
		"lips-sealed":{title:"Lips Sealed",codes:[":x",":-x",":X",":-X",":#",":-#",":=x",":=X",":=#"], src:"../Common/images/emoticons/lipssealed.png"},
		"mail":{title:"Mail",codes:["(e)","(m)"], src:"../Common/images/emoticons/mail.png"},
		"make-up":{title:"Make-up",codes:["(makeup)","(kate)"], src:"../Common/images/emoticons/makeup.png"},
		"mmm":{title:"Mmm...",codes:["(mm)"], src:"../Common/images/emoticons/mmm.png"},
		"mooning":{title:"Mooning",codes:["(mooning)"], src:"../Common/images/emoticons/mooning.png"},
		"movie":{title:"Movie",codes:["(~)","(film)","(movie)"], src:"../Common/images/emoticons/movie.png"},
		"muscle":{title:"Muscle",codes:["(muscle)","(flex)"], src:"../Common/images/emoticons/muscle.png"},
		"music":{title:"Music",codes:["(music)"], src:"../Common/images/emoticons/music.png"},
		"nerd":{title:"Nerd",codes:["8-|","B-|","8|","B|","8=|","B=|","(nerd)"], src:"../Common/images/emoticons/nerd.png"},
		"ninja":{title:"Ninja",codes:["(ninja)"], src:"../Common/images/emoticons/ninja.png"},
		"no":{title:"No",codes:["(n)","(N)"], src:"../Common/images/emoticons/no.png"},
		"nodding":{title:"Nodding",codes:["(nod)"], src:"../Common/images/emoticons/nod.png"},
		"party":{title:"Party!!!",codes:["(party)"], src:"../Common/images/emoticons/party.png"},
		"phone":{title:"Phone",codes:["(mp)","(ph)"], src:"../Common/images/emoticons/phone.png"},
		"pizza":{title:"Pizza",codes:["(pizza)","(pi)"], src:"../Common/images/emoticons/pizza.png"},
		"poolparty":{title:"Poolparty",codes:["(poolparty)"], src:"../Common/images/emoticons/poolparty.png"},
		"puke":{title:"Puke",codes:["(puke)",":&",":-&",":=&"], src:"../Common/images/emoticons/puke.png"},
		"punch":{title:"Punch",codes:["(punch)"], src:"../Common/images/emoticons/punch.png"},
		"rain":{title:"Rain",codes:["(rain)","(london)","(st)"], src:"../Common/images/emoticons/rain.png"},
		"rock":{title:"Rock",codes:["(rock)"], src:"../Common/images/emoticons/rock.png"},
		"rofl":{title:"Rolling on the floor laughing",codes:["(rofl)"], src:"../Common/images/emoticons/rofl.png"},
		"sad-smile":{title:"Sad Smile",codes:[":(",":=(",":-("], src:"../Common/images/emoticons/sadsmile.png"},
		"shaking":{title:"Shaking",codes:["(shake)"], src:"../Common/images/emoticons/shake.png"},
		"sleepy":{title:"Sleepy",codes:["|-)","I-)","I=)","(snooze)"], src:"../Common/images/emoticons/sleepy.png"},
		"smile":{title:"Smile",codes:[":)",":=)",":-)"], src:"../Common/images/emoticons/smile.png"},
		"smirking":{title:"Smirking",codes:["(smirk)"], src:"../Common/images/emoticons/smirk.png"},
		"smoking":{title:"Smoking",codes:["(smoking)","(smoke)","(ci)"], src:"../Common/images/emoticons/smoke.png"},
		"speechless":{title:"Speechless",codes:[":|",":=|",":-|"], src:"../Common/images/emoticons/speechless.png"},
		"star":{title:"Star",codes:["(*)"], src:"../Common/images/emoticons/star.png"},
		"sun":{title:"Sun",codes:["(sun)"], src:"../Common/images/emoticons/sun.png"},
		"swearing":{title:"Swearing",codes:["(swear)"], src:"../Common/images/emoticons/swear.png"},
		"sweating":{title:"Sweating",codes:["(sweat)","(:|"], src:"../Common/images/emoticons/sweating.png"},
		"talking":{title:"Talking",codes:["(talk)"], src:"../Common/images/emoticons/talking.png"},
		"thinking":{title:"Thinking",codes:["(think)",":?",":-?",":=?"], src:"../Common/images/emoticons/thinking.png"},
		"time":{title:"Time",codes:["(o)","(O)","(time)"], src:"../Common/images/emoticons/time.png"},
		"tmi":{title:"TMI",codes:["(tmi)"], src:"../Common/images/emoticons/tmi.png"},
		"toivo":{title:"Toivo",codes:["(toivo)"], src:"../Common/images/emoticons/toivo.png"},
		"tongue-out":{title:"Tongue Out",codes:[":P",":=P",":-P",":p",":=p",":-p"], src:"../Common/images/emoticons/tongueout.png"},
		"tumbleweed":{title:"Tumbleweed",codes:["(tumbleweed)"], src:"../Common/images/emoticons/tumbleweed.png"},
		"wait":{title:"Wait",codes:["(wait)"], src:"../Common/images/emoticons/wait.png"},
		"waiting":{title:"Waiting",codes:["(waiting)"], src:"../Common/images/emoticons/waiting.png"},
		"whew":{title:"Whew",codes:["(whew)"], src:"../Common/images/emoticons/whew.png"},
		"wfh":{title:"Working from home",codes:["(wfh)"], src:"../Common/images/emoticons/wfh.png"},
		"wink":{title:"Wink",codes:[":o",":=o",":-o",":O",":=O",":-O"], src:"../Common/images/emoticons/wink.png"},
		"wondering":{title:"Wondering",codes:[":^)"], src:"../Common/images/emoticons/wondering.png"},
		"worried":{title:"Worried",codes:[":S",":-S",":=S",":s",":-s",":=s"], src:"../Common/images/emoticons/worried.png"},
		"yawn":{title:"Yawn",codes:["(yawn)","|-()"], src:"../Common/images/emoticons/yawn.png"},
		"yes":{title:"Yes",codes:["(y)","(Y)","(ok)"], src:"../Common/images/emoticons/yes.png"}};


(function($, exports, window, name) {

if (!exports) {
    exports = {};

    if ($) {
        $[name] = exports;
    } else {
        window[name] = exports;
    }
}

var emoticons,
    codesMap = {},
    primaryCodesMap = {},
    regexp,
    metachars = /[[\]{}()*+?.\\|^$\-,&#\s]/g,
    entityMap;

entityMap = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;',
    '/': '&#x2F;'
};

function escape(string) {
    return String(string).replace(/[&<>"'\/]/g, function(s) {
        return entityMap[s];
    });
}

/**
 * Define emoticons set.
 *
 * @param {Object} data
 */
exports.define = function() {
    var name, i, codes, code,
        patterns = [];
    
    var data =  DEFINITION;

    for (name in data) {
        codes = data[name].codes;
        for (i in codes) {
            code = codes[i];
            codesMap[code] = name;

            // Create escaped variants, because mostly you want to parse escaped
            // user text.
            codesMap[escape(code)] = name;
            if (i == 0) {
                primaryCodesMap[code] = name;
            }
        }
    }

    for (code in codesMap) {
        patterns.push('(' + code.replace(metachars, "\\$&") + ')');
    }

    regexp = new RegExp(patterns.join('|'), 'g');
    emoticons = data;
};

/**
 * Replace emoticons in text.
 *
 * @param {String} text
 * @param {Function} [fn] optional template builder function.
 */
exports.replace = function(text, fn) {
    return text.replace(regexp, function(code) {
        var name = codesMap[code];
        return (fn || exports.tpl)(name, code, emoticons[name].title, emoticons[name].src);
    });
};

/**
 * Get primary emoticons as html string in order to display them later as overview.
 *
 * @param {Function} [fn] optional template builder function.
 * @return {String}
 */
exports.toString = function(fn) {
    var code,
        str = '',
        name;

    for (code in primaryCodesMap) {
        name = primaryCodesMap[code];
        str += (fn || exports.tpl)(name, code, emoticons[name].title, emoticons[name].src);
    }

    return str;
};

/**
 * Build html string for emoticons.
 *
 * @param {String} name
 * @param {String} code
 * @param {String} title
 * @return {String}
 */
exports.tpl = function(name, code, title, src) {
    return "<img class=\"emoticon\" ref=\"" + code + "\" src=\"" +  src+ "\" title=\"" + title + "\"/>";
    // return "<img class=\"emoticon emoticon-" + name + "\" ref=\"" + code + "\" src=\"" +  src+ "\" title=\"" + title + "\"/>";
    /* return '<span class="emoticon emoticon-' + name + '" title="' + title + '">' + code + '</span>'; */
};

}(typeof jQuery != 'undefined' ? jQuery : null,
  typeof exports != 'undefined' ? exports : null,
  window,
  'emoticons'));
